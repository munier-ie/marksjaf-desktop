{"version":3,"file":"main.cjs","sources":["../electron/main.ts"],"sourcesContent":["import {\r\n  app,\r\n  BrowserWindow,\r\n  ipcMain,\r\n  shell,\r\n  IpcMainInvokeEvent,\r\n  webContents,\r\n  net,\r\n} from \"electron\";\r\nimport { join, dirname } from \"path\";\r\nimport { spawn, ChildProcess } from \"child_process\";\r\nimport { fileURLToPath } from \"url\";\r\nimport { existsSync, readdirSync } from \"fs\";\r\n\r\n// ES module equivalent of __dirname\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\n\r\nconst isDev = process.env.NODE_ENV === \"development\";\r\nconst isPackaged = !isDev; // Simple: if not dev, then packaged\r\n\r\nlet mainWindow: BrowserWindow | null = null;\r\nlet backendProcess: ChildProcess | null = null;\r\n\r\ninterface ReceiptData {\r\n  businessName?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  email?: string;\r\n  orderNumber: string;\r\n  date: string;\r\n  orderType: string;\r\n  paymentMethod: string;\r\n  paymentDetails?: string;\r\n  status: string;\r\n  customerName?: string;\r\n  tableNumber?: string;\r\n  staff?: string;\r\n  items: Array<{\r\n    name: string;\r\n    quantity: number;\r\n    price: number;\r\n    total: number;\r\n  }>;\r\n  total: number;\r\n}\r\n\r\nconst createWindow = (): void => {\r\n  // Determine icon path based on environment\r\n  let iconPath: string;\r\n  if (isDev) {\r\n    iconPath = join(__dirname, \"../public/marksjaf-logo.png\");\r\n  } else if (isPackaged) {\r\n    iconPath = join(\r\n      process.resourcesPath,\r\n      \"app.asar.unpacked/public/marksjaf-logo.png\",\r\n    );\r\n  } else {\r\n    iconPath = join(__dirname, \"../public/marksjaf-logo.png\");\r\n  }\r\n\r\n  mainWindow = new BrowserWindow({\r\n    width: 1200,\r\n    height: 800,\r\n    minWidth: 800,\r\n    minHeight: 600,\r\n    title: \"MARKSJAF Kitchen - POS System\",\r\n    webPreferences: {\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n      webSecurity: true,\r\n      preload: join(__dirname, \"preload.cjs\"),\r\n    },\r\n    icon: iconPath,\r\n    show: false, // Keep false initially to prevent flicker before maximize\r\n    titleBarStyle: \"default\",\r\n    autoHideMenuBar: true,\r\n    fullscreen: true, // Start in fullscreen mode\r\n  });\r\n\r\n  // Maximize immediately if possible (though show: false keeps it hidden)\r\n  mainWindow.maximize();\r\n\r\n  if (mainWindow) {\r\n    mainWindow.setMenuBarVisibility(false);\r\n  }\r\n\r\n  // Load the app URL\r\n  if (isDev && mainWindow) {\r\n    mainWindow.loadURL(\"http://localhost:5173\");\r\n  } else {\r\n    // Production mode - load from dist-web\r\n    let indexPath: string;\r\n    if (isPackaged) {\r\n      const possiblePaths = [\r\n        join(process.resourcesPath, \"app.asar/dist-web/index.html\"),\r\n        join(process.resourcesPath, \"dist-web/index.html\"),\r\n        join(__dirname, \"../dist-web/index.html\"),\r\n      ];\r\n      indexPath = possiblePaths.find((p) => existsSync(p)) || possiblePaths[0];\r\n      console.log(\"üîç Trying packaged paths:\", possiblePaths);\r\n      console.log(\"üìç Selected path:\", indexPath);\r\n    } else {\r\n      indexPath = join(__dirname, \"../dist-web/index.html\");\r\n    }\r\n\r\n    if (existsSync(indexPath) && mainWindow) {\r\n      console.log(\"‚úÖ Index file exists, attempting to load...\");\r\n      mainWindow.loadFile(indexPath).catch((error) => {\r\n        console.error(\"‚ùå Failed to load file:\", error);\r\n        const altPath = join(process.cwd(), \"dist-web/index.html\");\r\n        if (existsSync(altPath) && mainWindow) {\r\n          console.log(\"üîÑ Trying alternative path...\");\r\n          mainWindow.loadFile(altPath);\r\n        } else {\r\n          console.error(\r\n            \"‚ùå Could not find index.html in any expected location\",\r\n          );\r\n        }\r\n      });\r\n    } else {\r\n      console.error(\"‚ùå Index file does not exist at:\", indexPath);\r\n      const altPath = join(process.cwd(), \"dist-web/index.html\");\r\n      if (existsSync(altPath) && mainWindow) {\r\n        console.log(\"üîÑ Trying alternative path...\");\r\n        mainWindow.loadFile(altPath);\r\n      } else {\r\n        console.error(\"‚ùå Could not find index.html in any expected location\");\r\n        console.error(\"üîç Current working directory:\", process.cwd());\r\n        console.error(\r\n          \"üìÅ Files in current directory:\",\r\n          readdirSync(process.cwd()),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // Add error logging for failed loads\r\n  if (mainWindow) {\r\n    mainWindow.webContents.on(\r\n      \"did-fail-load\",\r\n      (event, errorCode, errorDescription, validatedURL) => {\r\n        console.error(\r\n          \"Failed to load:\",\r\n          errorCode,\r\n          errorDescription,\r\n          validatedURL,\r\n        );\r\n      },\r\n    );\r\n  }\r\n\r\n  mainWindow.once(\"ready-to-show\", () => {\r\n    if (mainWindow) {\r\n      console.log(\r\n        \"‚úÖ ready-to-show event fired, maximizing and showing window...\",\r\n      );\r\n      mainWindow.maximize(); // Ensure maximized before showing\r\n      mainWindow.show();\r\n    }\r\n  });\r\n\r\n  // Fallback: show window after 3 seconds even if ready-to-show doesn't fire\r\n  // This ensures the window appears so users can see any error messages\r\n  setTimeout(() => {\r\n    if (mainWindow && !mainWindow.isVisible()) {\r\n      console.log(\"‚è∞ Timeout reached, showing window anyway...\");\r\n      mainWindow.maximize();\r\n      mainWindow.show();\r\n    }\r\n  }, 3000);\r\n\r\n  mainWindow.on(\"closed\", () => {\r\n    mainWindow = null;\r\n  });\r\n\r\n  if (mainWindow) {\r\n    // Only open external links (not localhost/internal navigation) in external browser\r\n    mainWindow.webContents.setWindowOpenHandler(({ url }: { url: string }) => {\r\n      // Allow internal navigation within the app\r\n      if (url.startsWith(\"http://localhost\") || url.startsWith(\"file://\")) {\r\n        return { action: \"allow\" };\r\n      }\r\n      // Open external links in default browser\r\n      shell.openExternal(url);\r\n      return { action: \"deny\" };\r\n    });\r\n\r\n    // Handle navigation within the same window\r\n    mainWindow.webContents.on(\"will-navigate\", (event, navigationUrl) => {\r\n      // Allow navigation to localhost URLs for desktop app\r\n      if (\r\n        navigationUrl.startsWith(\"http://localhost\") ||\r\n        navigationUrl.startsWith(\"file://\")\r\n      ) {\r\n        return; // Allow the navigation\r\n      }\r\n      // Prevent navigation to external URLs and open them externally instead\r\n      event.preventDefault();\r\n      shell.openExternal(navigationUrl);\r\n    });\r\n  }\r\n};\r\n\r\nconst startBackend = (): void => {\r\n  let backendPath: string;\r\n  let databasePath: string;\r\n  let uploadsDir: string;\r\n\r\n  if (isDev) {\r\n    backendPath = join(__dirname, \"../backend/server.js\");\r\n    // In development, use the database in the backend directory\r\n    databasePath = join(__dirname, \"../backend/prisma/database/marksjaf.db\");\r\n    uploadsDir = join(__dirname, \"../backend/uploads\");\r\n  } else if (isPackaged) {\r\n    // When packaged, backend is in resources\r\n    backendPath = join(process.resourcesPath, \"backend/server.js\");\r\n\r\n    // Check for \"portable\" mode (data folder next to executable)\r\n    // This allows \"win unpacked\" to be portable by keeping data in the same folder\r\n    const exeDir = dirname(app.getPath(\"exe\"));\r\n    const portableDataDir = join(exeDir, \"data\");\r\n\r\n    // Check if we effectively have write access to the executable directory or if a data folder exists\r\n    // For simplicity, we prioritize the local data folder if it exists, OR if we are not in Program Files (likely standalone/unpacked)\r\n    // But safely, let's look for the folder or create it if in a portable context\r\n\r\n    let usePortable = false;\r\n\r\n    // Check if 'data' folder exists next to exe\r\n    if (existsSync(portableDataDir)) {\r\n      usePortable = true;\r\n      console.log(\"üìÇ Found local data directory, using portable mode\");\r\n    } else {\r\n      // Logic to determine if we should create it?\r\n      // If the User specifically asked for \"win unpacked\" portability,\r\n      // usually that means everything lives in the folder.\r\n      // Let's default to creating 'data' locally if we can write there, otherwise fallback to userData\r\n      try {\r\n        // Attempt to access/write to exe dir\r\n        // This is a heuristic. If we are in Program Files, we probably can't write.\r\n        // If we are on Desktop/Documents/USB, we can.\r\n        if (!exeDir.toLowerCase().includes(\"program files\")) {\r\n          // We might be portable. Let's try to use local data dir.\r\n          // Only assume portable if specifically requested or configured?\r\n          // The user request is \"when i open the app (build setup and win unpacked) in another pc the image stops showing... fix that please\".\r\n          // This implies they move the folder and expect data to move with it.\r\n          // So we should prefer local data if possible.\r\n          usePortable = true;\r\n        }\r\n      } catch (e) {\r\n        console.log(\r\n          \"‚ö†Ô∏è Cannot check write access, defaulting to standard userData\",\r\n        );\r\n      }\r\n    }\r\n\r\n    if (usePortable) {\r\n      const dbDir = join(portableDataDir, \"database\");\r\n      uploadsDir = join(portableDataDir, \"uploads\");\r\n      databasePath = join(dbDir, \"marksjaf.db\");\r\n\r\n      // Ensure directories exist\r\n      const fs = require(\"fs\");\r\n      if (!existsSync(portableDataDir))\r\n        fs.mkdirSync(portableDataDir, { recursive: true });\r\n      if (!existsSync(dbDir)) fs.mkdirSync(dbDir, { recursive: true });\r\n      if (!existsSync(uploadsDir))\r\n        fs.mkdirSync(uploadsDir, { recursive: true });\r\n\r\n      console.log(\"üöÄ Running in PORTABLE mode. Data path:\", portableDataDir);\r\n    } else {\r\n      // Standard installation (userData)\r\n      const userDataPath = app.getPath(\"userData\");\r\n      const dbDir = join(userDataPath, \"database\");\r\n      uploadsDir = join(userDataPath, \"uploads\");\r\n      databasePath = join(dbDir, \"marksjaf.db\");\r\n\r\n      const fs = require(\"fs\");\r\n      if (!existsSync(dbDir)) fs.mkdirSync(dbDir, { recursive: true });\r\n      if (!existsSync(uploadsDir))\r\n        fs.mkdirSync(uploadsDir, { recursive: true });\r\n    }\r\n\r\n    // Copy initial database if it doesn't exist in the target location\r\n    if (!existsSync(databasePath)) {\r\n      const initialDbPath = join(\r\n        process.resourcesPath,\r\n        \"backend/prisma/database/marksjaf.db\",\r\n      );\r\n      if (existsSync(initialDbPath)) {\r\n        const fs = require(\"fs\");\r\n        fs.copyFileSync(initialDbPath, databasePath);\r\n        console.log(\"üìã Copied initial database to:\", databasePath);\r\n      } else {\r\n        console.log(\"‚ö†Ô∏è  Initial database not found at:\", initialDbPath);\r\n      }\r\n    }\r\n  } else {\r\n    // When built but not packaged (e.g. testing dist-electron directly)\r\n    backendPath = join(__dirname, \"../backend/server.js\");\r\n    databasePath = join(__dirname, \"../backend/prisma/database/marksjaf.db\");\r\n    uploadsDir = join(__dirname, \"../backend/uploads\");\r\n  }\r\n\r\n  console.log(\"Starting backend from:\", backendPath);\r\n  console.log(\"Database path:\", databasePath);\r\n  console.log(\"Uploads path:\", uploadsDir);\r\n\r\n  // Convert database path to file URL format for Prisma\r\n  const databaseUrl = `file:${databasePath.replace(/\\\\/g, \"/\")}`;\r\n\r\n  // Determine backend directory for cwd - critical for Prisma to find its engine\r\n  const backendDir = isDev\r\n    ? join(__dirname, \"../backend\")\r\n    : isPackaged\r\n      ? join(process.resourcesPath, \"backend\")\r\n      : join(__dirname, \"../backend\");\r\n\r\n  // Determine Prisma engine path for packaged builds\r\n  const prismaEnginePath = isPackaged\r\n    ? join(\r\n        process.resourcesPath,\r\n        \"backend/node_modules/.prisma/client/query_engine-windows.dll.node\",\r\n      )\r\n    : undefined;\r\n\r\n  // Log diagnostic info\r\n  const fs = require(\"fs\");\r\n  const logDir = isPackaged\r\n    ? join(app.getPath(\"userData\"), \"logs\")\r\n    : join(__dirname, \"../logs\");\r\n  if (!existsSync(logDir)) fs.mkdirSync(logDir, { recursive: true });\r\n  const logFile = join(logDir, \"backend.log\");\r\n  const logStream = fs.createWriteStream(logFile, { flags: \"w\" });\r\n\r\n  const logMsg = [\r\n    `[${new Date().toISOString()}] Backend startup diagnostics:`,\r\n    `  backendPath: ${backendPath}`,\r\n    `  backendDir (cwd): ${backendDir}`,\r\n    `  databaseUrl: ${databaseUrl}`,\r\n    `  uploadsDir: ${uploadsDir}`,\r\n    `  isPackaged: ${isPackaged}`,\r\n    `  isDev: ${isDev}`,\r\n    `  backendPath exists: ${existsSync(backendPath)}`,\r\n    `  backendDir exists: ${existsSync(backendDir)}`,\r\n    `  prismaEnginePath: ${prismaEnginePath || \"N/A\"}`,\r\n    `  prisma engine exists: ${prismaEnginePath ? existsSync(prismaEnginePath) : \"N/A\"}`,\r\n    `  .prisma/client dir exists: ${existsSync(join(backendDir, \"node_modules/.prisma/client\"))}`,\r\n    `  @prisma/client dir exists: ${existsSync(join(backendDir, \"node_modules/@prisma/client\"))}`,\r\n    `  schema.prisma exists: ${existsSync(join(backendDir, \"node_modules/.prisma/client/schema.prisma\"))}`,\r\n    `  process.resourcesPath: ${process.resourcesPath || \"N/A\"}`,\r\n    \"\",\r\n  ].join(\"\\n\");\r\n\r\n  logStream.write(logMsg);\r\n  console.log(logMsg);\r\n  console.log(\"üìù Backend log file:\", logFile);\r\n\r\n  backendProcess = spawn(\"node\", [backendPath], {\r\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\r\n    windowsHide: true, // Hide console window on Windows\r\n    cwd: backendDir, // Set cwd so Prisma can resolve its engine via process.cwd()\r\n    env: {\r\n      ...process.env,\r\n      NODE_ENV: isDev ? \"development\" : \"production\",\r\n      DATABASE_URL: databaseUrl,\r\n      UPLOADS_DIR: uploadsDir,\r\n      IS_PACKAGED: isPackaged ? \"true\" : \"false\",\r\n      ...(prismaEnginePath\r\n        ? { PRISMA_QUERY_ENGINE_LIBRARY: prismaEnginePath }\r\n        : {}),\r\n    },\r\n  });\r\n\r\n  // Pipe backend stdout/stderr to log file for diagnostics\r\n  if (backendProcess.stdout) {\r\n    backendProcess.stdout.on(\"data\", (data: Buffer) => {\r\n      const text = data.toString();\r\n      logStream.write(text);\r\n      console.log(\"[backend]\", text.trim());\r\n    });\r\n  }\r\n  if (backendProcess.stderr) {\r\n    backendProcess.stderr.on(\"data\", (data: Buffer) => {\r\n      const text = data.toString();\r\n      logStream.write(`[STDERR] ${text}`);\r\n      console.error(\"[backend-err]\", text.trim());\r\n    });\r\n  }\r\n\r\n  backendProcess.on(\"error\", (error) => {\r\n    const errMsg = `Backend process error: ${error.message}\\n${error.stack}\\n`;\r\n    logStream.write(errMsg);\r\n    console.error(errMsg);\r\n  });\r\n\r\n  backendProcess.on(\"exit\", (code) => {\r\n    const exitMsg = `Backend process exited with code ${code}\\n`;\r\n    logStream.write(exitMsg);\r\n    console.log(exitMsg);\r\n  });\r\n};\r\n\r\nconst stopBackend = (): void => {\r\n  if (backendProcess) {\r\n    backendProcess.kill();\r\n    backendProcess = null;\r\n  }\r\n};\r\n\r\n/**\r\n * Poll http://localhost:5000 until the backend is ready, then resolve.\r\n * This prevents the race condition where the Electron window loads before\r\n * the Express backend is listening ‚Äî which causes \"network error\" toasts.\r\n */\r\nconst waitForBackend = (port = 5000, timeoutMs = 30000): Promise<void> => {\r\n  return new Promise((resolve) => {\r\n    const start = Date.now();\r\n    const interval = setInterval(() => {\r\n      const req = net.request(`http://localhost:${port}`);\r\n      req.on('response', () => {\r\n        clearInterval(interval);\r\n        console.log(`‚úÖ Backend is ready on port ${port}`);\r\n        resolve();\r\n      });\r\n      req.on('error', () => {\r\n        // Not ready yet ‚Äî keep waiting unless we've timed out\r\n        if (Date.now() - start >= timeoutMs) {\r\n          clearInterval(interval);\r\n          console.warn(`‚ö†Ô∏è Backend did not start within ${timeoutMs}ms ‚Äî opening window anyway`);\r\n          resolve();\r\n        }\r\n      });\r\n      req.end();\r\n    }, 500);\r\n  });\r\n};\r\n\r\n// App event handlers\r\nconsole.log(\"üöÄ Electron app starting...\");\r\n\r\napp.whenReady().then(async () => {\r\n  console.log(\"üì± App ready, starting backend...\");\r\n  startBackend();\r\n\r\n  // Wait until the backend Express server is actually listening before\r\n  // opening the window ‚Äî this eliminates the \"network error\" race condition\r\n  // that occurred in packaged builds where Prisma takes several seconds to load.\r\n  console.log(\"‚è≥ Waiting for backend to be ready...\");\r\n  await waitForBackend(5000, 30000);\r\n\r\n  console.log(\"üñ•Ô∏è Creating window...\");\r\n  createWindow();\r\n\r\n  app.on(\"activate\", () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      createWindow();\r\n    }\r\n  });\r\n});\r\n\r\napp.on(\"window-all-closed\", () => {\r\n  stopBackend();\r\n  if (process.platform !== \"darwin\") {\r\n    app.quit();\r\n  }\r\n});\r\n\r\napp.on(\"before-quit\", () => {\r\n  stopBackend();\r\n});\r\n\r\n// Store for custom default printer (persists in memory)\r\nlet customDefaultPrinter: string | null = null;\r\n\r\n// IPC handler to set custom default printer\r\nipcMain.handle(\r\n  \"set-default-printer\",\r\n  async (event: IpcMainInvokeEvent, printerName: string) => {\r\n    try {\r\n      customDefaultPrinter = printerName;\r\n      return { success: true, printer: printerName };\r\n    } catch (error) {\r\n      console.error(\"Error setting default printer:\", error);\r\n      return { success: false, error: String(error) };\r\n    }\r\n  },\r\n);\r\n\r\n// IPC handler to get custom default printer\r\nipcMain.handle(\"get-default-printer\", async (event: IpcMainInvokeEvent) => {\r\n  return customDefaultPrinter;\r\n});\r\n\r\n// IPC handler for getting system printers\r\n// Returns all configured printers - Windows handles actual availability during print\r\nipcMain.handle(\"get-printers\", async () => {\r\n  try {\r\n    const allPrinters =\r\n      (await webContents.getAllWebContents()[0]?.getPrintersAsync()) || [];\r\n\r\n    const printers = allPrinters.map((printer) => {\r\n      return {\r\n        name: printer.name,\r\n        displayName: printer.displayName,\r\n        description: printer.description,\r\n        status: \"ready\",\r\n        isOnline: true,\r\n        isDefault: (printer as any).isDefault,\r\n        options: printer.options,\r\n      };\r\n    });\r\n\r\n    return printers;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error getting printers:\", error);\r\n    return [];\r\n  }\r\n});\r\n\r\n// IPC handler for printing receipts (HTML-based, shows print dialog)\r\n// This is the legacy method - works but not optimal for thermal printers\r\nipcMain.handle(\r\n  \"print-receipt\",\r\n  async (event: IpcMainInvokeEvent, receiptData: ReceiptData) => {\r\n    try {\r\n      // Get the custom default printer if set\r\n      const printerName = customDefaultPrinter;\r\n\r\n      // Create a hidden window for printing\r\n      const printWindow = new BrowserWindow({\r\n        width: 225, // Approx 59mm width (58mm + buffer)\r\n        height: 600,\r\n        show: false,\r\n        webPreferences: {\r\n          nodeIntegration: false,\r\n          contextIsolation: true,\r\n        },\r\n      });\r\n\r\n      // Generate HTML for receipt\r\n      const receiptHTML = generateReceiptHTML(receiptData);\r\n\r\n      // Save HTML for debugging purposes (in user data folder)\r\n      try {\r\n        const fs = require(\"fs\");\r\n        const debugPath = join(\r\n          app.getPath(\"userData\"),\r\n          \"last_receipt_debug.html\",\r\n        );\r\n        fs.writeFileSync(debugPath, receiptHTML);\r\n        console.log(\"üìù Saved debug receipt HTML to:\", debugPath);\r\n      } catch (e) {\r\n        console.error(\"‚ö†Ô∏è Failed to save debug receipt HTML:\", e);\r\n      }\r\n\r\n      await printWindow.loadURL(\r\n        `data:text/html;charset=utf-8,${encodeURIComponent(receiptHTML)}`,\r\n      );\r\n\r\n      // Print options for thermal printer\r\n      const printOptions: any = {\r\n        silent: false, // Show print dialog so user can verify settings\r\n        printBackground: true,\r\n        margins: {\r\n          marginType: \"custom\" as const,\r\n          top: 0,\r\n          bottom: 0,\r\n          left: 0,\r\n          right: 0,\r\n        },\r\n        pageSize: {\r\n          width: 58000, // 58mm in micrometers\r\n          height: 200000, // Auto height\r\n        },\r\n      };\r\n\r\n      // If we have a custom default printer, specify it\r\n      if (printerName) {\r\n        printOptions.deviceName = printerName;\r\n      }\r\n\r\n      await printWindow.webContents.print(\r\n        printOptions,\r\n        (success, failureReason) => {\r\n          printWindow.close();\r\n\r\n          if (success) {\r\n          } else {\r\n            console.error(\"‚ùå Print failed:\", failureReason);\r\n          }\r\n        },\r\n      );\r\n\r\n      return { success: true };\r\n    } catch (error) {\r\n      console.error(\"‚ùå Print error:\", error);\r\n      return { success: false, error: (error as Error).message };\r\n    }\r\n  },\r\n);\r\n\r\n// IPC handler for RAW thermal printing via backend API\r\n// This is the preferred method for thermal printers - sends raw text directly\r\nipcMain.handle(\r\n  \"print-thermal\",\r\n  async (\r\n    event: IpcMainInvokeEvent,\r\n    data: { text: string; printerName?: string },\r\n  ) => {\r\n    try {\r\n      const targetPrinter = data.printerName || customDefaultPrinter;\r\n      if (targetPrinter) {\r\n      }\r\n\r\n      // Call the backend API to print\r\n      const response = await fetch(\r\n        \"http://localhost:5000/api/printers/print-raw\",\r\n        {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            // Note: In production, you'd need to handle auth token here\r\n          },\r\n          body: JSON.stringify({\r\n            text: data.text,\r\n            printerName: targetPrinter,\r\n          }),\r\n        },\r\n      );\r\n\r\n      const result = (await response.json()) as {\r\n        success: boolean;\r\n        error?: string;\r\n        jobId?: string;\r\n      };\r\n\r\n      if (result.success) {\r\n      } else {\r\n        console.error(\"‚ùå RAW thermal print failed:\", result.error);\r\n      }\r\n\r\n      return result;\r\n    } catch (error) {\r\n      console.error(\"‚ùå RAW thermal print error:\", error);\r\n      return { success: false, error: (error as Error).message };\r\n    }\r\n  },\r\n);\r\n\r\nfunction generateReceiptHTML(receiptData: ReceiptData): string {\r\n  const formattedDate = new Date(receiptData.date).toLocaleString(\"en-NG\", {\r\n    day: \"2-digit\",\r\n    month: \"2-digit\",\r\n    year: \"2-digit\",\r\n    hour: \"2-digit\",\r\n    minute: \"2-digit\",\r\n    hour12: true,\r\n  });\r\n\r\n  // Fix address newlines - replace with comma and space\r\n  const formattedAddress = (receiptData.address || \"\").replace(/\\n/g, \", \");\r\n\r\n  return `\r\n    <!DOCTYPE html>\r\n    <html>\r\n    <head>\r\n      <meta charset=\"UTF-8\">\r\n      <style>\r\n        @page {\r\n          size: 58mm auto;\r\n          margin: 0;\r\n        }\r\n        body { \r\n          font-family: 'Courier New', Courier, monospace;\r\n          font-size: 13px;\r\n          font-weight: 900;\r\n          margin: 0; \r\n          padding: 10px 0;\r\n          width: 58mm; \r\n          max-width: 58mm;\r\n          color: #000000;\r\n          background-color: #ffffff;\r\n        }\r\n        * {\r\n          box-sizing: border-box;\r\n          color: #000000 !important;\r\n          font-weight: 900 !important;\r\n        }\r\n        .center { text-align: center; }\r\n        .bold { font-weight: 900; }\r\n        .right { text-align: right; }\r\n        .left { text-align: left; }\r\n        \r\n        .line { border-bottom: 2px dashed #000; margin: 3px 0; width: 100%; }\r\n        .double-line { border-bottom: 3px double #000; margin: 3px 0; width: 100%; }\r\n        \r\n        /* Spacing Helpers */\r\n        .spacer { height: 10px; width: 100%; }\r\n        .divider { border-bottom: 2px dashed #000; margin: 5px 0; width: 100%; }\r\n\r\n        .header { margin-bottom: 15px; } \r\n        .footer { margin-top: 15px; font-size: 10px; }\r\n        \r\n        /* Inline Field Style - Left Aligned */\r\n        .field {\r\n          margin-bottom: 2px;\r\n          display: flex;\r\n          justify-content: flex-start; /* Left align */\r\n          gap: 5px; /* Small gap */\r\n        }\r\n        .field-label {\r\n          /* No fixed width, just natural flow */\r\n        }\r\n        \r\n        .item-row { margin-bottom: 2px; border-bottom: 1px dotted #000; padding-bottom: 2px; }\r\n        .item-name { display: block; width: 100%; white-space: normal; }\r\n        \r\n        /* Item Data - Left Aligned */\r\n        .item-data { \r\n          display: flex; \r\n          justify-content: flex-start; \r\n          font-size: 11px; \r\n          gap: 15px; /* Fixed small gap between Qty/Price and Total */\r\n        }\r\n\r\n        .total-section { font-size: 13px; font-weight: 900; margin: 5px 0; }\r\n      </style>\r\n    </head>\r\n    <body>\r\n      <div class=\"header center\">\r\n        <div class=\"bold\" style=\"font-size: 14px;\">${receiptData.businessName || \"MARKSJAF KITCHEN\"}</div>\r\n        <div style=\"height: 10px;\"></div>\r\n        <div style=\"font-size: 10px;\">${formattedAddress}</div>\r\n        <div class=\"spacer\"></div>\r\n      </div>\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <!-- Inline Fields -->\r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Date:</span>\r\n        <span>${formattedDate}</span>\r\n      </div>\r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Order:</span>\r\n        <span class=\"bold\">#${receiptData.orderNumber}</span>\r\n      </div>\r\n      ${\r\n        receiptData.customerName\r\n          ? `\r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Customer:</span>\r\n        <span>${receiptData.customerName}</span>\r\n      </div>`\r\n          : \"\"\r\n      }\r\n      ${\r\n        receiptData.tableNumber\r\n          ? `\r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Table:</span>\r\n        <span>${receiptData.tableNumber}</span>\r\n      </div>`\r\n          : \"\"\r\n      }\r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Type:</span>\r\n        <span>${receiptData.orderType.toUpperCase()}</span>\r\n      </div>\r\n      \r\n      <div class=\"line\"></div>\r\n      \r\n      <!-- Items List -->\r\n      <div style=\"width: 100%;\">\r\n        ${receiptData.items\r\n          .map(\r\n            (item) => `\r\n          <div class=\"item-row\">\r\n            <div class=\"item-name\">${item.name}</div>\r\n            <div class=\"item-data\">\r\n              <span>${item.quantity} x ${item.price.toFixed(0)}</span>\r\n              <span class=\"bold\">${item.total.toFixed(0)}</span>\r\n            </div>\r\n          </div>\r\n        `,\r\n          )\r\n          .join(\"\")}\r\n      </div>\r\n      \r\n      <div class=\"line\"></div>\r\n      \r\n      <div class=\"total-section\">\r\n        <div style=\"display: flex; justify-content: flex-start; gap: 10px;\">\r\n          <span>TOTAL:</span>\r\n          <span>‚Ç¶${receiptData.total.toFixed(2)}</span>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"double-line\"></div>\r\n      \r\n      <div class=\"field\">\r\n        <span class=\"field-label\">Pay:</span>\r\n        <span>${receiptData.paymentMethod?.toUpperCase()}</span>\r\n      </div>\r\n      \r\n      <div class=\"divider\"></div>\r\n      <div class=\"spacer\"></div>\r\n      \r\n      <div class=\"footer center\">\r\n        <div class=\"bold\">Thank you!</div>\r\n        ${receiptData.customerName ? `<div>${receiptData.customerName}</div>` : \"\"}\r\n        <div>Tel: ${receiptData.phone || \"+234 8032549466\"}</div>\r\n      </div>\r\n      <br />\r\n    </body>\r\n    </html>\r\n  `;\r\n}\r\n"],"names":["__filename","fileURLToPath","__dirname","dirname","join","BrowserWindow","existsSync","readdirSync","url","shell","app","fs","spawn","net","ipcMain","webContents"],"mappings":"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"}